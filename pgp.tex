\section{Шифрование файлов и почтовых сообщений в PGP}

В качестве примера для передачи файлов по сети с обеспечением аутентификации, конфиденциальности и целостности рассмотрим систему PGP (Pretty Good Privacy), разработанную Филом Циммерманном (Phil Zimmermann) в 1991 г. Изначально система предлагалась к использованию для защищенной передачи электронной почты. Реализации PGP с открытым программным кодом включают OpenPGP и GPG (GnuPG).

Каждый пользователь обладает одним или несколькими секретными ключами для криптосистемы с открытым ключом, которые используются для аутентификации посредством ЭЦП.  Пользователь хранит также открытые ключи других пользователей, которые он использует для шифрования секретного сеансового ключа блокового шифрования. Передаваемое сообщение подписывается секретным ключом отправителя, затем сообщение шифруется блоковой криптосистемой на случайно выбранном сеансовом ключе, сам сеансовый ключ шифруется криптосистемой с открытым ключом на открытом ключе получателя.

Свои секретные ключи отправитель хранит в зашифрованном виде. Набор ключей называется связкой секретных ключей. Шифрование секретных ключей в связке производится блоковой криптосистемой, ключом которой является пароль, вводимый пользователем. Шифрование секретных ключей, хранимых на компьютере, является стандартной практикой для защиты от утечки ключей, например, в случае взлома ОС, утери ПК и т.д.

Набор открытых ключей других пользователей называется связкой открытых ключей.

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.9\textwidth]{pic/pgp}
	\caption{Схема обработки сообщения в PGP\label{fig:pgp}}
\end{figure}

На рис. \ref{fig:pgp} представлена схема обработки сообщения в PGP для передачи от $A$ к $B$. Использование аутентификации, сжатия и блокового шифрования является опциональным. Обозначения на рисунке следующие.
\begin{itemize}
    \item Пароль -- пароль, вводимый отправителем для расшифрования связки своих секретных ключей.
    \item $D$ -- расшифрование блоковой криптосистемы для извлечения секретного ключа ЭЦП отправителя.
    \item $SK_A$ -- секретный ключ ЭЦП отправителя.
    \item $ID_{SKa}$ -- идентификатор секретного ключа ЭЦП отправителя, по которому получатель определяет, какой ключ из связки открытых ключей использовать для проверки подписи.
    \item $m$ -- сообщение (файл) для передачи.
    \item $h(m)$ -- криптографическая хэш-функция.
    \item $E_{SKa}$ -- схема ЭЦП на секретном ключе $SK_A$.
    \item $\|$ -- конкатенация битовых строк.
    \item $Z$ -- сжатие сообщения алгоритмом компрессии.
    \item $RND$ -- криптографический генератор псевдослучайной последовательности.
    \item $K_s$ -- сгенерированный псевдослучайный сеансовый ключ.
    \item $E_{Ks}$ -- блоковое шифрование на секретном сеансовом ключе $K_s$.
    \item $PK_B$ -- открытый ключ получателя.
    \item $ID_{PKb}$ -- идентификатор открытого ключа получателя, по которому получатель определяет, какой секретный ключ из связки секретных ключей использовать для расшифрования сеансового ключа.
    \item $E_{PKb}$ -- шифрование сеансового ключа криптосистемой с открытым ключом на открытом ключе $B$.
    \item $c$ -- зашифрованное подписанное сообщение.
\end{itemize}
