<!DOCTYPE html SYSTEM "about:legacy-compat">
<html><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><style type="text/css"> 
div.toc-item-h2 {
  padding-left: 2em;
}
div.toc-item-h3 {
  padding-left: 4em;
}
div.toc-item-h4 {
  padding-left: 6em;
}
div.toc-item-h5 {
  padding-left: 8em;
}
div.toc-item-h6 {
  padding-left: 10em;
}
</style><link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" rel="stylesheet"><style type="text/css"> 
span.small {
  font-size: 90%
}
span.tiny {
  font-size: 50%
}
</style><style type="text/css"> 
div.mathjax {
  padding-top: .5em;
  padding-bottom: .5em;
}
</style></head><body><div class="container"><h2 data-command-name="section" id="8_8_Blockchain_цепочка_блоков_">8.8. Blockchain (цепочка блоков)</h2><p><a name="N90505"><!--Blockchain|(--></a>
Когда у вас есть знания о том, что такое криптографически стойкая хеш-функция, понять, что такое цепочка блоков (англ. <span lang="en"><i>blockchain</i></span>), очень просто. Blockchain &ndash; это последовательный набор блоков (или же, в более общем случае, ориентированный граф), каждый следующий блок в котором включает в качестве хешируемой информации значение хеш-функции от предыдущего блока.</p><p>Технология <span lang="en">block<wbr></wbr>chain</span>используется для организации журналов транзакций, при этом под транзакцией может пониматься что угодно: финансовая транзакция (перевод между счетами), аудит событий аутентификации и авторизации, записи о выполненных ТО и ТУ автомобилей. При этом событие считается случившимся, если запись о нём включена в журнал.</p><p>В таких системах есть три группы действующих лиц:</p><ul><li>генераторы событий (транзакций);</li><li>генераторы блоков (фиксаторы транзакций);</li><li>получатели (читатели) блоков и зафиксированных транзакций.</li></ul><p>В зависимости от реализации эти группы могут пересекаться. В системах типа Bitcoin<a name="N90543"><!--Bitcoin--></a>, например, все участники распределённой системы могут выполнять все три функции. Хотя за создание блоков (фиксацию транзакций) обычно отвечают выделенные вычислительные мощности, а управляющих ими участников называют майнерами (англ. <span lang="en"><i>miners</i></span>, см. раздел про децентрализованный <span lang="en">block<wbr></wbr>chain</span>далее).</p><p>Основное требование к таким журналам таково:</p><ul><li>невозможность модификации журнала: после записи транзакции в журнал должно быть невозможно её оттуда удалить или изменить.</li></ul><p>Для того чтобы понять, как можно выполнить требование на запрет модификации, стоит разобраться со следующими вопросами.</p><ul><li>Каким образом гарантируется, что внутри блока нельзя поменять информацию?</li><li>Каким образом система гарантирует, что уже существующую цепочку блоков нельзя перегенерировать, тем самым исправив в них информацию?</li></ul><p>Ответ на первый вопрос прост: нужно снабдить каждый блок хеш-суммой от его содержимого. И эту хеш-сумму включить в качестве дополнительной полезной информации (тоже хешируемой) в следующий блок. Тогда для того, чтобы поменять что-то в блоке без разрушения доверия клиентов к нему, нужно будет это сделать таким образом, чтобы хеш-сумма от блока не поменялась. А это как раз практически невозможно, если у нас используется криптографически стойкая хеш-функция. Либо поменять в том числе и хеш-сумму блока. Но тогда придётся менять и значение этой хеш-суммы в следующем блоке. А это потребует изменений, в свою очередь, в хеш-сумме всего второго блока, а потом и в третьем, и так далее. Получается, что для того, чтобы поменять информацию в одном из блоков, нужно будет перегенерировать всю цепочку блоков, начиная с модифицируемого. Можно ли это сделать?</p><p>Тут нужно ответить на вопрос, как в подобных системах защищаются от возможности перегенерации цепочки блоков. Мы рассмотрим три варианта систем:</p><ul><li>централизованный с доверенным центром,</li><li>централизованный с недоверенным центром,</li><li>децентрализованный вариант с использованием доказательства работы.</li></ul><h3 data-command-name="subsection" id="8_8_1_Централизованный_blockchain_с_доверенным_центром">8.8.1. Централизованный blockchain<line-break></line-break> с доверенным центром</h3><p>Если у нас есть доверенный центр, то мы просто поручаем ему через определённый промежуток времени (или же через определённый набор транзакций) формировать новый блок, снабжая его не только хеш-суммой, но и своей электронной подписью. Каждый клиент системы имеет возможность проверить, что все блоки в цепочке сгенерированы доверенным центром и никем иным. В предположении, что доверенный центр не скомпрометирован, возможности модификации журнала злоумышленником нет.</p><p>Использование технологии <span lang="en">block<wbr></wbr>chain</span>в этом случае является избыточным. Если у нас есть доверенный центр, можно просто обращаться к нему с целью подписать каждую транзакцию, добавив к ней время и порядковый номер. Номер обеспечивает порядок и невозможность добавления (удаления) транзакций из цепочки, электронная подпись доверенного центра &ndash; невозможность модификации конкретных транзакций.</p><h3 data-command-name="subsection" id="8_8_2_Централизованный_blockchain_с_недоверенным_центром">8.8.2. Централизованный blockchain<line-break></line-break> с недоверенным центром</h3><p>Интересен случай, когда выделенный центр не является доверенным. Точнее, не является полностью доверенным. Мы ему доверяем в плане фиксации транзакций в журнале, но хотим быть уверенными, что выделенный центр не перегенерирует всю цепочку блоков, удалив из неё ненужные ему более транзакции или добавив нужные.</p><p>Для этого можно использовать, например, следующие методы.</p><ul><li>Первый метод с использованием дополнительного доверенного хранилища. После создания очередного блока центр должен отправить в доверенное и независимое от данного центра хранилище хеш-код от нового блока. Доверенное хранилище не должно принимать никаких изменений к хеш-кодам уже созданных блоков. В качестве такого хранилища можно использовать и децентрализованную базу данных системы, если таковая присутствует. Размер хранимой информации может быть небольшим по сравнению с общим объёмом журнала.</li><li>Второй возможный метод состоит в дополнении каждого блока меткой времени, сгенерированной доверенным центром временных меток. Такая метка должна содержать время генерации метки и электронную подпись центра, вычисленную на основании хеш-кода блока и времени метки. В случае, если &laquo;недоверенный&raquo; центр захочет перегенерировать часть цепочки блоков, будет наблюдаться разрыв в метках времени. Стоит отметить, что этот метод не гарантирует, что &laquo;недоверенный&raquo; центр не будет генерировать сразу две цепочки блоков, дополняя их корректными метками времени, а потом не подменит одну другой.</li><li>Некоторые системы предлагают связывать закрытые <span lang="en">block<wbr></wbr>chain</span>-решения и открытые (и неконтролируемые ими) сети вроде Bitcoin'а, публикуя в последнем (в виде транзакции) информацию о хеш-суммах новых блоков из закрытой цепочки. В этом случае информация из открытой и неконтролируемой организацией сети позволяет доказать, что определённый блок во внутренней сети был сформирован не позднее времени создания блока в открытой сети. А отсутствие для известных (заданных заранее) адресов отправителя других транзакций позволяет доказать, что центральный узел не формирует какую-нибудь параллельную цепочку для замены в будущем.</li></ul><h3 data-command-name="subsection" id="8_8_3_Децентрализованный_blockchain">8.8.3. Децентрализованный blockchain</h3><p>Наибольший интерес для нас &ndash; и наименьший для компаний, продающих <span lang="en">block<wbr></wbr>chain</span>-решения, &ndash; представляет децентрализованная система <span lang="en">block<wbr></wbr>chain</span>без выделенных центров генерации блоков. Каждый участник может взять набор транзакций, ожидающих включения в журнал, и сформировать новый блок. Более того, в системах типа Bitсoin<a name="N90686"><!--Bitcoin--></a> такой участник (будем его назвать &laquo;майнером&raquo;, от англ. <span lang="en"><i>to mine</i></span> &ndash; копать) ещё и получит премию в виде определённой суммы и/или комиссионных от принятых в блок транзакций.</p><p>Но нельзя просто так взять и сформировать блок в децентрализованных системах. Надёжность таких систем основывается именно на том, что новый блок нельзя сформировать быстрее (в среднем) чем за определённое время. Например, за 10 минут (Bitcoin). Это обеспечивается механизмом, который получил название доказательство работы (англ. <span lang="en"><i>proof of work, PoW</i></span>).</p><p>Механизм основывается на следующей идее. Пусть есть криптографически стойкая хеш-функция <span class="mathjax">$h(x)$</span>, и задан некоторый параметр <span class="mathjax">$t$</span> (от англ. <span lang="en"><i>target</i></span> &ndash; цель). <span class="mathjax">$0 &lt; t &lt; 2^{n}$</span>, где <span class="mathjax">$n$</span> &ndash; размер выхода хеш-функции в битах. Корректным новым блоком <span lang="en">block<wbr></wbr>chain</span>-сеть будет признавать только такой, значение хеш-суммы которого меньше текущего заданного параметра <span class="mathjax">$t$</span>. В этом случае алгоритм работы майнера выглядит следующий образом:</p><ul><li>собрать из пула незафиксированных транзакций те, которые поместятся в 1 блок (1 мегабайт для сети Bitcoin<a name="N90760"><!--Bitcoin--></a>) и имеют максимальную комиссию (решить задачу о рюкзаке<a name="N90766"><!--задача!о рюкзаке--></a>);</li><li>добавить в блок информацию о предыдущем блоке;</li><li>добавить в блок информацию о себе (как об авторе блока, кому начислять комиссии и бонусы за блок);</li><li>установить <span class="mathjax">$r$</span> в некоторое значение, например, <span class="mathjax">$0$</span>;</li><li>выполнять в цикле:
	<ul><li>обновить значение <span class="mathjax">$r := r + 1$</span>;</li><li>посчитать значение <span class="mathjax">$h = h( \text{блок} || r)$</span>;</li><li>если <span class="mathjax">$h &lt; t$</span>, добавить в блок <span class="mathjax">$r$</span> и считать блок сформированным, иначе &ndash; повторить цикл.</li></ul></li></ul><p>Для каждой итерации цикла вероятность получить корректный блок равна <span class="mathjax">$t / 2^{n}$</span>. Так как <span class="mathjax">$t$</span> обычно мало, то майнерам нужно сделать большое количество итераций цикла, чтобы найти нужный <span class="mathjax">$r$</span>. При этом только один (обычно &ndash; первый) из найденных блоков будет считаться корректным. Чем больше вычислительная мощность конкретного майнера, тем больше вероятность, что именно он первым сумеет найти нужный <span class="mathjax">$r$</span>.</p><p>Зная суммарную вычислительную мощность <span lang="en">block<wbr></wbr>chain</span>-сети, участники могут договориться о таком механизме изменения параметра <span class="mathjax">$t$</span>, чтобы время генерации нового корректного блока было примерно заданное время. Например, в сети Bitcoin параметр <span class="mathjax">$t$</span> пересчитывается каждые 2016 блоков таким образом, чтобы среднее время генерации блока было 10 минут. Это позволяет адаптировать сеть к изменению количества участников, их вычислительных мощностей и к появлению новых механизмов вычисления хеш-функций.</p><p>Кроме задания параметра <span class="mathjax">$t$</span> можно оперировать другими величинами, так или иначе относящимися к мощности вычислений.</p><ul><li><i>Hashrate</i> &ndash; количество хешей, которые считают за единицы времени конкретный майнер или сеть в целом. Например, в ноябре 2017 года общий hashrate для сети Bitcoin составлял примерно <span class="mathjax">$7,7 \times 10^{18}$</span> хешей в секунду.</li><li><i>Difficulty</i> &ndash; сложность поиска корректного блока, выражаемая как <span class="mathjax">$d = d_{const} / t$</span>, где <span class="mathjax">$d_{const}$</span> &ndash; некоторая константа сложности, а <span class="mathjax">$t$</span> &ndash; текущая цель (англ. <span lang="en"><i>target</i></span>). В отличие от параметра <span class="mathjax">$t$</span>, который падает с ростом вычислительной мощности сети, <span class="mathjax">$d$</span> изменяется вместе с <span class="mathjax">$hashrate$</span>, что делает его более простым для восприятия и анализа человеком.</li></ul><p>В случае примерно одновременной генерации следующего блока двумя и более майнерами (когда информация о новом блоке публикуется вторым майнером до того, как ему придёт информация о новом блоке от первого) в направленном графе блоков происходит разветвление. Далее каждый из майнеров выбирает один из новых блоков (например &ndash; какой первый увидели) и пытается сгенерировать новый блок на основе выбранного, продолжая &laquo;ответвление&raquo; в графе. В конце концов одна из двух таких цепочек становится длиннее (та, которую выбрало большее число майнеров), и именно она признаётся основной.</p><p>В случае нормального поведения системы на включение конкретных транзакций в блоки это влияет мало, так как каждый из добросовестных майнеров следует одному и тому же алгоритму включения транзакций в блок (например, в сети Bitcoin<a name="N90888"><!--Bitcoin--></a> &ndash; алгоритму максимизации комиссии за блок). Однако можно предположить, что какой-нибудь злоумышленник захочет &laquo;модерировать&raquo; распределённый <span lang="en">block<wbr></wbr>chain</span>, включая или не включая в блоки транзакции по своему выбору. Предположим, что доля вычислительных ресурсов злоумышленника (направленных на генерацию нового блока) равна <span class="mathjax">$p, 0 &lt; p &lt; 1/2$</span>. В этом случае каждый следующий сгенерированный блок с вероятностью <span class="mathjax">$p$</span> будет сгенерирован мощностями злоумышленника. Это позволит ему включать в блоки те транзакции, которые другие майнеры включать не захотели.</p><p>Но позволит ли это злоумышленнику не включать что-то в цепочку транзакций? Нет. Потому что после его блока с вероятностью <span class="mathjax">$1 - p$</span> будет следовать блок &laquo;обычного&raquo; майнера, который с радостью (пропорциональной комиссии-награде) включит все транзакции в свой блок.</p><p>Однако ситуация меняется, если мощности злоумышленника составляют более 50 от мощности сети. В этом случае, если после блока злоумышленника был с вероятностью <span class="mathjax">$1 - p$</span> сгенерирован &laquo;обычный&raquo; блок, злоумышленник его может просто проигнорировать и продолжать генерировать новые блоки, как будто он единственный майнер в сети. Тогда если среднее время генерации одного блока всеми мощностями <span class="mathjax">$t$</span>, то за время <span class="mathjax">$T$</span> злоумышленник сможет сгенерировать <span class="mathjax">$N_E = p \times T / t$</span>, а легальные пользователи <span class="mathjax">$N_L = (1 - p) \times T / t$</span> блоков, <span class="mathjax">$N_E &gt; N_L$</span>. Даже если с некоторой вероятностью легальные пользователи сгенерируют 2 блока быстрее, чем злоумышленник один, последний всё равно &laquo;догонит и перегонит&raquo; &laquo;легальную&raquo; цепочку примерно за время <span class="mathjax">$t / (2p - 1)$</span>. Так как в <span lang="en">block<wbr></wbr>chain</span>есть договоренность, что за текущее состояние сети принимается наиболее длинная цепочка, именно цепочка злоумышленника всегда будет восприниматься правильной. Получается, что злоумышленник сможет по своему желанию включать или не включать транзакции в цепочки.</p><p>Правда, пользоваться чужими деньгами злоумышленник всё равно не сможет &ndash; так как все блоки транзакций проверяются на внутреннюю непротиворечивость и корректность всех включённых в блок транзакций.</p><p>Кроме концепции &laquo;доказательство работы&raquo; можно использовать и другие. Например, в подходе &laquo;доказательство доли владения&raquo; (англ. <span lang="en"><i>proof of share, PoS</i></span>), который планировалось использовать в сетях Etherium и EmerCoin, вероятность генерации блока пропорциональна количеству средств на счетах потенциальных создателей нового блока. Это намного более энергоэффективно по сравнению с PoW, и, кроме того, связывает ответственность за надёжность и корректность генерации новых блоков с размером капитала (чем больше у нас средств, тем меньше мы хотим подвергать опасности систему). С другой стороны, это даёт дополнительную мотивацию концентрировать больше капитала в одних руках, что может привести к централизации системы.</p><h3 data-command-name="subsection" id="8_8_4_Механизм_внесения_изменений_в_протокол">8.8.4. Механизм внесения изменений в протокол</h3><p>Любая система должна развиваться. Но у децентрализованных систем нельзя просто &laquo;включить один рубильник&raquo; и заставить участников системы работать по-новому &ndash; иначе систему нельзя назвать полностью децентрализованной. Механизмы и способы внесения изменений могут выглядеть на первый взгляд нетривиально. Например:</p><ol><li>апологеты системы предлагают изменения в правилах работы;</li><li>авторы ПО вносят изменения в программный код, позволяя сделать две вещи:
	<ul><li>указать участникам системы, что они поддерживают новое изменение,</li><li>поддержать новое изменение;</li></ul></li><li>участники системы скачивают новую версию и выставляют в новых блоках транзакций (или в самих транзакциях) сигнальные флаги, показывающие их намерение поддержать изменение;</li><li>если к определённой дате определённое число блоков (или число транзакций, или объём транзакций) содержат сигнальный флаг, то изменение считается принятым, и большая (по числу новых блоков) часть участников системы в определённую дату включают эти изменения;</li><li>те участники, которые не приняли изменения, или приняли изменения вопреки отсутствию согласия на них большей части участников, в худшем случае начнут генерировать свою цепочку блоков, только её признавая корректной. Основную цепочку блоков они будут считать неверно сгенерированной. По факту это приведёт к дублированию (разветвлению, форку) системы, когда в какую-то дату вместо одного журнала транзакций появляется два, ведущимися разными людьми. Это журналы совпадают до определённой даты, после чего в них начинаются расхождение.</li></ol><p>Подводя итоги, Сатоши Накамото (псевдоним, англ. <span lang="en"><i>Satoshi Nakamoto</i></span>), автор технологий blockchain и Bitcoin<a name="N91000"><!--Bitcoin--></a>, сумел предложить работающий децентрализованный механизм, в котором и само поведение системы, и изменения к этой системе проходят через явный или неявный механизм поиска консенсуса участников. Для получения контроля над системой в целом злоумышленнику придётся получить контроль как минимум над 50 всех мощностей системы (в случае PoW), а без этого можно лишь попытаться ограничить возможность использования системы конкретными участниками.</p><p>Однако созданная технология не лишена недостатков. Существуют оценки, согласно которым использование метода PoW для системы bitcoin приводит к затратам энергии, сравнимой с потреблением электричества целыми городами или странами. Есть проблемы и с поиском консенсуса &ndash; сложный механизм внесения изменений, как считают некоторые эксперты, может привести к проблемам роста (например, из-за ограниченности числа транзакций в блоке), и, в будущем, к отказу использования механизма как устаревшего и не отвечающего будущим задачам.</p><p><a name="N91006"><!--Blockchain|)--></a></p><nav aria-label="Page navigation example"><ul class="pagination justify-content-center"><li class="page-item"><a class="page-link" href="8_7_Kogda_vredno_heshirovat.html">&#129080; 8_7_Kogda_vredno_heshirovat</a></li><li class="page-item"><a class="page-link" href="Glava_9_Asimmetrichnie_kriptosistemi.html">Glava_9_Asimmetrichnie_kriptosistemi &#129082;</a></li></ul></nav></div><script>
window.MathJax = {
  loader: {
    load: ['[tex]/tagformat'],
  },
  options: {
    processHtmlClass: 'mathjax'
  },
  tex: {
    packages: {
      '[+]': ['base', 'ams', 'physics', 'textcomp']
    },
    inlineMath: [['$', '$']],
  },
};
</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script async="yes" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script></body></html>