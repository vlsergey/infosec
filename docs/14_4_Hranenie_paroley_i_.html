<!DOCTYPE html SYSTEM "about:legacy-compat">
<html><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><style type="text/css"> 
div.toc-item-h2 {
  padding-left: 2em;
}
div.toc-item-h3 {
  padding-left: 4em;
}
div.toc-item-h4 {
  padding-left: 6em;
}
div.toc-item-h5 {
  padding-left: 8em;
}
div.toc-item-h6 {
  padding-left: 10em;
}
</style><link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" rel="stylesheet"><style type="text/css"> 
span.small {
  font-size: 90%
}
span.tiny {
  font-size: 50%
}
</style><style type="text/css"> 
div.mathjax {
  padding-top: .5em;
  padding-bottom: .5em;
}
</style></head><body><div class="container"><h2 data-command-name="section" id="14_4_Хранение_паролей_и_аутентификация_в_ОС">14.4. Хранение паролей и <command name="protect"></command><line-break></line-break> аутентификация в ОС</h2><p>Для усложнения подбора пароля и защиты от словарной атаки перед процедурой хеширования к паролю добавляется &laquo;соль&raquo; &ndash; случайная битовая строка. <em>&laquo;Солью&raquo;</em> (salt)<a name="N109861"><!--соль--></a> называется (псевдо-)слу<wbr></wbr>чай<wbr></wbr>ная битовая строка <span class="mathjax">$s$</span>, добавляемая к аргументу <span class="mathjax">$m$</span> (паролю) функции хеширования <span class="mathjax">$h(m)$</span> для рандомизации хеширования одинаковых сообщений.</p><p><em>Словарная</em> атака заключается в том, что злоумышленник один раз заранее вычисляет таблицы хешей от наиболее <em>вероятных</em> сообщений, то есть составляет словарь пароль-хеш, и далее производит поиск по вычисленной таблице для взламывания исходного сообщения. Ранее словарные атаки использовались для взлома паролей <span class="mathjax">$m$</span>, которые хранились в виде обычных хешей <span class="mathjax">$h(m)$</span>. Усовершенствованной словарной атакой является метод радужных таблиц, позволяющий практически взламывать хеши длиной до 64--128 бит. Использование &laquo;соли&raquo; делает невозможной словарную атаку, так как значение функции вычисляется уже не от оригинального пароля, а от конкатенации &laquo;соли&raquo; и пароля.</p><p>&laquo;Соль&raquo; может храниться как отдельное значение, единственное и уникальное для системы целиком, так и быть уникальной для каждого сохранённого пароля и храниться со значением функции хеширования:</p><ul><li><span class="mathjax">$s ~\|~ h(s ~\|~ m)$</span>;</li><li><span class="mathjax">$s ~\|~ h(m ~\|~ s)$</span>;</li><li><span class="mathjax">$s_1 ~\|~ h(m ~\|~ s_1 ~\|~ s_2)$</span>.</li></ul><p>В первом случае функция хеширования вычисляется от конкатенации (склеивания) &laquo;соли&raquo; и пароля пользователя. Во втором случае в строке сначала идёт пароль, а потом &ndash; &laquo;соль&raquo;. Это позволяет немного усложнить задачу злоумышленнику при переборе паролей (он не сможет сократить время вычисления значения функции хеширования за счёт одинакового префикса у всех аргументов функции хеширования). В третьем случае используется сразу две &laquo;соли&raquo;: одна хранится вместе с паролем, а вторая выступает внешним параметром, хранящимся отдельно от базы данных паролей.</p><p>В рассмотренной ранее модели построения паролей в виде слогов с элементами небольшой модификации мы получили количество паролей около <span class="mathjax">$2^{70}$</span> для 12-символьных паролей. Данный объём вычислений уже почти достижим. Следовательно, даже &laquo;соль&raquo; не защищает пароли от взлома, если у злоумышленника есть доступ к файлу с паролями или возможность неограниченных попыток аутентификации. Поэтому файлы с паролями дополнительно защищаются, а в системы аутентификации по паролю вводят ограничения на неуспешные попытки аутентификации.</p><h3 data-command-name="subsection" id="14_4_1_Хранение_паролей_в_Unix">14.4.1. Хранение паролей в Unix</h3><p>В ОС Unix данные пароля пользователей хранятся в специальном файле <tt>/etc/shadow</tt>, запрещённого к чтению для обычных (не привилегированных) пользователям и сервисам. Данные хранятся в виде хеша (SHA, MD5 и<span class="nonbreaking-interword-space"> </span>т.<span class="nonbreaking-interword-space"> </span>д.) или результата шифрования (DES, Blowfish и<span class="nonbreaking-interword-space"> </span>т.<span class="nonbreaking-interword-space"> </span>д.), вычисленного с &laquo;солью&raquo; <span class="mathjax">$s$</span> длиной от 2 (для функции crypt в оригинальной ОС UNIX) до 16 (для Blowfish в OpenBSD) ASCII-символов. То, как используется &laquo;соль&raquo;, зависит от используемого алгоритма. Например, в традиционном алгоритме, используемом в оригинальном UNIX, &laquo;соль&raquo; модифицирует s-блоки и p-блоки в протоколе DES.</p><h3 data-command-name="subsection" id="14_4_2_Хранение_паролей_и_аутентификация_в_Windows">14.4.2. Хранение паролей и аутентификация в <command name="protect"></command><line-break></line-break> Windows</h3><!--%[MS-NLMP]: NT LAN Manager (NTLM) Authentication Protocol Specification - - 09/25/2009, Rev. 11.0--><!--%http://blogs.technet.com/authentication/archive/2006/04/07/ntlm-s-time-has-passed.aspx--><!--%http://technet.microsoft.com/en-us/library/cc755284(WS.10).aspx - - Windows Authentication, Updated: February 7, 2008--><!--%http://207.46.16.252/en-us/magazine/2006.08.securitywatch.aspx - The Most Misunderstood Windows Security Setting of All Time, Jesper Johansson--><!--%http://en.wikipedia.org/wiki/NTLM--><!--%http://www.windowsnetworking.com/nt/atips/atips92.shtml--><p>ОС Windows, начиная с Vista, Server 2008, Windows 7, сохраняет пароли в виде NT-хеша, который вычисляется как 128-битовый хеш MD4 от пароля в Unicode кодировке. NT-хеш не использует &laquo;соль&raquo;, поэтому применима словарная атака. На словарной атаке основаны программы поиска (взлома) паролей для Windows. Файл паролей называется SAM (англ. <span lang="en"><i>Security Account Manager</i></span>) в случае локальной аутентификации. Если пароли хранятся на сетевом сервере, то они хранятся в специальном файле, доступ к которому ограничен.</p><p>В последнем протоколе аутентификации NTLMv2<a name="N109984"><!--протокол!NTLM--></a><a name="N109989"><!--протокол!NTLMv2--></a><span class="nonbreaking-interword-space"> </span><a href="Literatura.html#MS-NLMP">[81]</a> пользователь для входа в свой компьютер аутентифицируется либо локально на компьютере, либо удалённым сервером, если учётная запись пользователя хранится на сервере. Пользователь с именем <span class="mathjax">$user$</span> вводит пароль в программу-<em>клиент</em>, которая, взаимодействуя с программой-<em>сервером</em> (локальной или удалённой на сервере домена <span class="mathjax">$domain$</span>), аутентифицирует пользователя для входа в систему.</p><ol><li>Клиент <span class="mathjax">$\rightarrow$</span> Сервер: запрос аутентификации.</li><li>Клиент <span class="mathjax">$\leftarrow$</span> Сервер: 64-битовая псевдослучайная одноразовая метка <span class="mathjax">$n_s$</span>.</li><li>Вводимый пользователем пароль хешируется в <span class="mathjax">$\textrm{NThash}$</span> без &laquo;соли&raquo;. Клиент генерирует 64-битовую псевдослучайную одноразовую метку <span class="mathjax">$n_c$</span>, создаёт метку времени <span class="mathjax">$ts$</span>. Далее вычисляются 128-битовые имитовставки<a name="N110042"><!--имитовставка--></a> <span class="mathjax">${\textrm{HMAC}}$</span> на хеш-функции MD5 с ключами <span class="mathjax">$\textrm{NT-hash}$</span> и <span class="mathjax">$\textrm{NTOWF}$</span>:
        <div class="mathjax" style="text-align: center;">$$ \textrm{NThash} = \text{MD4}(\text{Unicode}(\text{пароль})), $$</div>
        <div class="mathjax" style="text-align: center;">$$ \textrm{NTOWF} = \textrm{HMAC-MD5}_{\textrm{NThash}}(user, domain), $$</div>
        <!--%\[ \text{LMv2-response} = \text{HMAC-MD5}_{\text{NTLMv2-hash}}(n_c, n_s), \]-->        <div class="mathjax" style="text-align: center;">$$ \textrm{NTLMv2-response} = \textrm{HMAC-MD5}_{\textrm{NTOWF}}(n_c, n_s, ts, domain). $$</div></li><li>Клиент <span class="mathjax">$\rightarrow$</span> Сервер: <span class="mathjax">$(n_c, \textrm{NTLMv2-response})$</span>. <!--%LMv2-response,--></li><li>Сервер для указанных имён пользователя и домена извлекает из базы паролей требуемый NT-hash, производит аналогичные вычисления и сравнивает значения имитовставок. Если они совпадают, аутентификация успешна.</li></ol><p>В случае аутентификации на локальном компьютере сравниваются значения <span class="mathjax">$\textrm{NTOWF}$</span>: вычисленные от пароля пользователя и извлечённые из файла паролей SAM.</p><p>Как видно, протокол аутентификации NTLMv2 обеспечивает одностороннюю аутентификацию пользователя серверу (или своему ПК).</p><p>При удалённой аутентификации по сети последние версии ОС Windows используют протокол Kerberos (см. раздел<span class="nonbreaking-interword-space"> </span><span class="nonbreaking-interword-space"> </span><a href="#sec:kerberos">13.1</a>), который обеспечивает взаимную аутентификацию клиента и сервера, и, только если аутентификация по Kerberos не поддерживается клиентом или сервером, она происходит по NTLMv2.</p><nav aria-label="Page navigation example"><ul class="pagination justify-content-center"><li class="page-item"><a class="page-link" href="14_3_Autentifikatsija_po_parolju.html">&#129080; 14_3_Autentifikatsija_po_parolju</a></li><li class="page-item"><a class="page-link" href="14_5_Autentifikatsija_v_veb_servisah.html">14_5_Autentifikatsija_v_veb_servisah &#129082;</a></li></ul></nav></div><script>
window.MathJax = {
  loader: {
    load: ['[tex]/tagformat'],
  },
  options: {
    processHtmlClass: 'mathjax'
  },
  tex: {
    packages: {
      '[+]': ['base', 'ams', 'physics', 'textcomp']
    },
    inlineMath: [['$', '$']],
  },
};
</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script async="yes" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script></body></html>