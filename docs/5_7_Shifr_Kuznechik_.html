<!DOCTYPE html SYSTEM "about:legacy-compat">
<html><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><style type="text/css"> 
div.toc-item-h2 {
  padding-left: 2em;
}
div.toc-item-h3 {
  padding-left: 4em;
}
div.toc-item-h4 {
  padding-left: 6em;
}
div.toc-item-h5 {
  padding-left: 8em;
}
div.toc-item-h6 {
  padding-left: 10em;
}
</style><link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" rel="stylesheet"><style type="text/css"> 
span.small {
  font-size: 90%
}
span.tiny {
  font-size: 50%
}
</style><style type="text/css"> 
div.mathjax {
  padding-top: .5em;
  padding-bottom: .5em;
}
</style></head><body><div class="container"><h2 data-command-name="section" id="5_7_Шифр_Кузнечик_">5.7. Шифр &laquo;Кузнечик&raquo;</h2><p><a name="N83685"><!--шифр!Кузнечик|(--></a>
В июне 2015 года в России был принят новый стандарт блочного шифрования ГОСТ Р 34.12-2015<span class="nonbreaking-interword-space"> </span><a href="Literatura.html#GOST-R:34.12-2015">[117]</a>. Данный стандарт включает в себя два блочных шифра &ndash; старый ГОСТ 28147-89, получивший теперь название &laquo;Магма&raquo;, и новый шифр со 128-битным входным блоком, получившим название &laquo;Кузнечик&raquo;.</p><p>В отличие от шифра &laquo;Магма&raquo;, новый шифр &laquo;Кузнечик&raquo; основан на SP-сети<a name="N83696"><!--SP-сеть--></a> (сети замен и перестановок), то есть основан на серии обратимых преобразований, а не на ячейке Фейстеля<a name="N83702"><!--ячейка Фейстеля--></a>. Как и другие популярные шифры, он является блочным раундовым шифром и имеет выделенную процедуру выработки раундовых ключей. Шифр работает с блоками открытого текста по 128 бит, а размер ключа шифра составляет 256 бит. Отдельный раунд шифра &laquo;Кузнечик&raquo; состоит из операции наложения ключа, нелинейного и линейного преобразований, как изображено на рис.<span class="nonbreaking-interword-space"> </span><a href="5_7_Shifr_Kuznechik_.html#fig:kuznechik-step">5.8</a>. Всего в алгоритме 10 раундов, последний из которых состоит только из операции наложения ключа.</p><figure style="margin-left: auto; margin-right: auto; display: flex; flex-wrap: wrap; align-items: baseline; justify-content: center; width: fit-content; height: fit-content; width: 80%;"><a name="fig:kuznechik-step" style="vertical-align: top; align-self: start;"></a><img src="images/958FE7D79284A87530919389C81A13BA.png" style="width: 100%"><figcaption style="flex-basis: 100%; text-align: center;">Рис. 5.8 &mdash; Один раунд шифрования в алгоритме &laquo;Кузнечик&raquo;</figcaption></figure><p>Нелинейное преобразование <span class="mathjax">$S$</span> разбивает блок данных из 128 бит на 16 блоков по 8 бит в каждом, как показано на рис.<span class="nonbreaking-interword-space"> </span><a href="5_7_Shifr_Kuznechik_.html#fig:kuznechik-s">5.9</a>.</p><figure style="margin-left: auto; margin-right: auto; display: flex; flex-wrap: wrap; align-items: baseline; justify-content: center; width: fit-content; height: fit-content; width: 90%;"><a name="fig:kuznechik-s" style="vertical-align: top; align-self: start;"></a><img src="images/DE142DB0FAA4EF730D8DA91533EB2E4C.png" style="width: 100%"><figcaption style="flex-basis: 100%; text-align: center;">Рис. 5.9 &mdash; Нелинейное преобразование <span class="mathjax">$S$</span> в алгоритме &laquo;Кузнечик&raquo;</figcaption></figure><p>Каждый из 16 восьмибитных блоков <span class="mathjax">$a$</span> трактуется как целое беззнаковое число <span class="mathjax">$\text{Int}_8 a$</span> и выступает в качестве индекса в заданном массиве констант <span class="mathjax">$\pi'$</span>. Значение по индексу <span class="mathjax">$\text{Int}_8 a$</span> в массиве констант <span class="mathjax">$\pi'$</span> обратно преобразуется в двоичный вид и выступает в качестве одного из 16 выходных блоков нелинейного преобразования <span class="mathjax">$S$</span>.</p><blockquote><command name="noindent"><argument required="true"><command name="scriptsize"></command><span class="mathjax">$\pi'$</span> = (252, 238, 221, 17, 207, 110, 49, 22, 251, 196, 250, 218, 35, 197, 4, 77, 233, 119, 240, 219, 147, 46, 153, 186, 23, 54, 241. 187, 20, 205, 95, 193, 249, 24, 101, 90, 226, 92, 239, 33, 129, 28, 60, 66, 139, 1, 142, 79, 5, 132, 2, 174, 227, 106, 143, 160, 6, 11, 237, 152, 127, 212, 211, 31, 235, 52, 44, 81, 234, 200, 72, 171, 242, 42, 104, 162, 253, 58, 206, 204, 181, 112, 14, 86, 8, 12, 118, 18, 191, 114, 19, 71, 156, 183, 93, 135, 21, 161, 150, 41, 16, 123, 154, 199, 243, 145, 120, 111, 157, 158, 178, 177, 50, 117, 25, 61, 255, 53, 138, 126, 109, 84, 198, 128, 195, 189, 13, 87, 223, 245, 36, 169, 62, 168, 67, 201, 215, 121, 214, 246, 124, 34, 185, 3, 224, 15, 236, 222, 122, 148, 176, 188, 220, 232, 40, 80, 78, 51, 10, 74, 167, 151, 96, 115, 30, 0, 98, 68, 26, 184, 56, 130, 100, 159, 38, 65, 173, 69, 70, 146, 39, 94, 85, 47, 140, 163, 165, 125, 105, 213, 149, 59, 7, 88, 179, 64, 134, 172, 29, 247, 48, 55, 107, 228, 136, 217, 231, 137, 225, 27, 131, 73, 76, 63, 248, 254, 141, 83, 170, 144, 202, 216, 133, 97, 32, 113, 103, 164, 45, 43, 9, 91, 203, 155, 37, 208, 190, 229, 108, 82, 89, 166, 116, 210, 230, 244, 180, 192, 209, 102, 175, 194, 57, 75, 99, 182).</argument></command></blockquote><p>Линейное преобразование <span class="mathjax">$L$</span> состоит из 16 операций линейного преобразования <span class="mathjax">$R$</span>, то есть <span class="mathjax">$L = R^{16}$</span>. Линейное преобразование <span class="mathjax">$R$</span>, в свою очередь, использует блок из 128 бит как начальные значения 8 битовых ячеек регистра сдвига, связанного с 16 ячейками линейной обратной связью (РСЛОС), как показано на рис.<span class="nonbreaking-interword-space"> </span><a href="5_7_Shifr_Kuznechik_.html#fig:kuznechik-p">5.10</a>. При сдвиге вычисляется сумма значений ячеек, домноженных на 16 констант. Значения ячеек и константы трактуются как элементы поля Галуа <span class="mathjax">$GF(2^8)$</span> с модулем <span class="mathjax">$p(x) = x^8 + x^7 + x^6 + x + 1$</span> (см. раздел<span class="nonbreaking-interword-space"> </span><a href="#section-fields">16.3.5</a>), умножение и сложение также проходят в этом поле.</p><figure style="margin-left: auto; margin-right: auto; display: flex; flex-wrap: wrap; align-items: baseline; justify-content: center; width: fit-content; height: fit-content; width: 90%;"><a name="fig:kuznechik-p" style="vertical-align: top; align-self: start;"></a><img src="images/D6A425F9589569D7B6754B63B4D108EC.png" style="width: 100%"><figcaption style="flex-basis: 100%; text-align: center;">Рис. 5.10 &mdash; Линейное преобразование <span class="mathjax">$R$</span> в алгоритме &laquo;Кузнечик&raquo;</figcaption></figure><p>Алгоритм развёртывания ключа основан на ячейке Фейстеля, хотя и не использует её ключевую особенность &ndash; обратимость. Начало алгоритма изображено на рис.<span class="nonbreaking-interword-space"> </span><a href="5_7_Shifr_Kuznechik_.html#fig:kuznechik-keys">5.11</a>.</p><figure style="margin-left: auto; margin-right: auto; display: flex; flex-wrap: wrap; align-items: baseline; justify-content: center; width: fit-content; height: fit-content; width: 90%;"><a name="fig:kuznechik-keys" style="vertical-align: top; align-self: start;"></a><img src="images/00E301585C7FB0CA83A89D5072E059F7.png" style="width: 100%"><figcaption style="flex-basis: 100%; text-align: center;">Рис. 5.11 &mdash; Часть алгоритма развёртывания ключа в &laquo;Кузнечике&raquo;</figcaption></figure><ul><li>Целые числа <span class="mathjax">$i$</span> от 1 до 32 представляются в виде двоичных векторов по 128 бит. К каждому из них применяется линейное преобразование <span class="mathjax">$L=R^{16}$</span>, как было описано ранее. Получаются 32 константы <span class="mathjax">$C_{1}, \dots, C_{32}$</span>.</li><li>Первые два раундовых ключа <span class="mathjax">$K_1$</span> и <span class="mathjax">$K_2$</span> получаются разбиением мастер-ключа <span class="mathjax">$K$</span> (256 бит) на два блока по 128 бит каждый.</li><li>Следующая пара раундовых ключей <span class="mathjax">$K_3$</span> и <span class="mathjax">$K_4$</span> получается из первой пары <span class="mathjax">$K_1$</span> и <span class="mathjax">$K_2$</span> применением 8 раундов ячейки Фейстеля. В качестве функции Фейстеля, преобразующей один из блоков на каждом раунде, выступает преобразование <span class="mathjax">$\text{LSX}(C_i)$</span>, <span class="mathjax">$i=1,\dots,8$</span>. То есть (читая справа налево, как принято с операторами) побитовое сложение с заданной константой <span class="mathjax">$C_i$</span>, а потом нелинейное и линейное преобразования <span class="mathjax">$S$</span> и <span class="mathjax">$L$</span>, как они были описаны ранее.</li><li>Все остальные пары раундовых ключей вплоть до <span class="mathjax">$K_{9}$</span> и <span class="mathjax">$K_{10}$</span> получаются аналогичным образом (использованием предыдущей пары ключей и 8 констант <span class="mathjax">$C_i$</span>).</li></ul><p>Так как и легальный отправитель, и легальный получатель используют функцию развёртывания ключа в прямом направлении, начиная с пары (<span class="mathjax">$K_1, K_2$</span>), заканчивая парой (<span class="mathjax">$K_{9}, K_{10}$</span>), то алгоритм никогда не &laquo;идёт назад&raquo; и не использует ключевую особенность ячейки Фейстеля &ndash; её обратимость.</p><p>В отличие от стандарта 1989 года новый стандарт не включает режимы сцепления блоков, они были вынесены в отдельный ГОСТ Р 34.13-2015 &laquo;Режимы работы блочных шифров&raquo;<span class="nonbreaking-interword-space"> </span><a href="Literatura.html#GOST-R:34.13-2015">[118]</a>.</p><p>В работе 2015 года Бирюков, Перрин и Удовенко (англ. <span lang="en"><i>Alex Biryukov, L&eacute;o Perrin, Aleksei Udovenko</i></span>,<span class="nonbreaking-interword-space"> </span><a href="Literatura.html#Biryukov:Perrin:Udovenko:2015">[14]</a>) продемонстрировали, что структура s-блока не является случайной, а получена в результате работы детерминированного алгоритма. Это может быть использовано для создания более быстрых реализаций алгоритма шифрования, но теоретически может быть и основой для атак на шифр.</p><p><a name="N84013"><!--шифр!Кузнечик|)--></a></p><nav aria-label="Page navigation example"><ul class="pagination justify-content-center"><li class="page-item"><a class="page-link" href="5_6_Standart_shifrovanija_SShA_AES.html">&#129080; 5_6_Standart_shifrovanija_SShA_AES</a></li><li class="page-item"><a class="page-link" href="5_8_Rezhimi_raboti_blochnih_shifrov.html">5_8_Rezhimi_raboti_blochnih_shifrov &#129082;</a></li></ul></nav></div><script>
window.MathJax = {
  loader: {
    load: ['[tex]/tagformat'],
  },
  options: {
    processHtmlClass: 'mathjax'
  },
  tex: {
    packages: {
      '[+]': ['base', 'ams', 'physics', 'textcomp']
    },
    inlineMath: [['$', '$']],
  },
};
</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script async="yes" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script></body></html>